# Flutter 桌面适配验证清单

## 概述

本文档提供 Flutter 桌面适配功能的完整验证清单。由于 AI 无法实际运行桌面应用，本清单需要由开发者或 CI 环境执行。

**验证日期**: 2025-12-24  
**任务状态**: Task 1-12 已完成，Task 13 验证中  
**风险项**: Task 9 (WebView 适配) 已跳过，WebView 功能未适配（flutter_inappwebview 不支持桌面）

---

## 静态验证结果

### ✅ 代码分析 (flutter analyze)

**执行命令**: `flutter analyze`  
**结果**: 通过（16 个警告，无错误）

**警告说明**:
- 9 个 file_picker 插件警告（插件本身问题，不影响功能）
- 7 个代码质量警告（未使用的导入、变量、方法等）

**建议**: 可以清理未使用的代码，但不影响桌面适配功能。

### ✅ 依赖项检查

**桌面相关依赖**:
- ✅ `window_manager: ^0.3.7` - 窗口管理
- ✅ `desktop_webview_window: ^0.2.3` - 桌面 WebView（未使用）
- ✅ `file_picker: ^6.1.1` - 文件选择
- ✅ `path_provider: ^2.1.0` - 路径获取
- ✅ `flutter_cache_manager: ^3.4.1` - 图片缓存

**平台支持验证** (基于插件文档):
- ✅ `window_manager` - 支持 Windows, macOS, Linux
- ✅ `file_picker` - 支持 Windows, macOS, Linux
- ⚠️ `desktop_webview_window` - 已添加但未使用（Task 9 跳过）
- ❌ `flutter_inappwebview` - 不支持桌面平台（仅 Android/iOS）

### ✅ 关键组件实现检查

**已实现组件**:
- ✅ `PlatformService` - 平台检测服务
- ✅ `WindowManagerService` - 窗口管理服务
- ✅ `AppPerfConfig` - 性能配置（按平台）
- ✅ `AppImageCacheManager` - 图片缓存管理
- ✅ `AdaptiveFilePicker` - 自适应文件选择器
- ✅ `KeyboardShortcuts` - 键盘快捷键工具
- ✅ `HomeShell` - 响应式导航布局
- ✅ `AppTheme` - 桌面端主题优化

**未实现组件**:
- ❌ `AdaptiveWebView` - WebView 适配（Task 9 跳过）

---

## 手动测试清单

### 前置条件

- [ ] 已安装 Flutter SDK (3.10.3+)
- [ ] 已安装目标平台开发工具:
  - Windows: Visual Studio 2022 with Desktop development with C++
  - macOS: Xcode
  - Linux: 必要的开发库 (gtk, etc.)
- [ ] 已执行 `flutter pub get`

### 1. 核心功能测试

#### 1.1 应用启动

**测试步骤**:
```bash
# Windows
flutter run -d windows

# macOS
flutter run -d macos

# Linux
flutter run -d linux
```

**预期结果**:
- [ ] 应用成功启动
- [ ] 窗口默认大小为 1200x800
- [ ] 窗口最小尺寸为 800x600
- [ ] 窗口标题显示 "CordysCRM"

**失败表现**:
- 应用崩溃或无法启动
- 窗口尺寸不正确
- 控制台显示错误日志

#### 1.2 响应式布局

**测试步骤**:
1. 启动应用后，观察导航组件
2. 调整窗口宽度到 < 600px
3. 调整窗口宽度到 >= 600px
4. 重复多次

**预期结果**:
- [ ] 宽度 >= 600px 时显示左侧 NavigationRail
- [ ] 宽度 < 600px 时显示底部 BottomNavigationBar
- [ ] 切换布局时导航状态保持一致
- [ ] 布局切换流畅无闪烁

**失败表现**:
- 同时显示两个导航组件
- 导航状态丢失
- 布局切换时崩溃

#### 1.3 导航功能

**测试步骤**:
1. 点击导航栏的每个选项（工作台、客户、线索、商机、我的）
2. 验证页面切换正常
3. 在不同页面间来回切换

**预期结果**:
- [ ] 所有导航选项可点击
- [ ] 页面切换正常
- [ ] 当前选中项高亮显示
- [ ] 页面状态保持（如滚动位置）

**失败表现**:
- 点击无响应
- 页面切换失败
- 选中状态不正确

### 2. 窗口管理测试

#### 2.1 窗口调整

**测试步骤**:
1. 拖动窗口边缘调整大小
2. 尝试将窗口缩小到 < 800x600
3. 最大化窗口
4. 恢复窗口大小

**预期结果**:
- [ ] 窗口可以自由调整大小
- [ ] 无法缩小到 800x600 以下
- [ ] 最大化/恢复功能正常
- [ ] 内容随窗口大小自适应

**失败表现**:
- 窗口尺寸约束失效
- 内容不随窗口调整
- 最大化后无法恢复

#### 2.2 窗口状态保存

**测试步骤**:
1. 调整窗口大小和位置
2. 关闭应用
3. 重新启动应用

**预期结果**:
- [ ] 窗口大小恢复到关闭前的状态
- [ ] 窗口位置恢复到关闭前的位置

**失败表现**:
- 窗口状态未保存
- 每次启动都是默认大小和位置

### 3. 文件选择功能测试

#### 3.1 图片选择

**测试步骤**:
1. 进入客户/线索/商机编辑页面
2. 点击图片选择按钮
3. 选择单张图片
4. 选择多张图片
5. 取消选择

**预期结果**:
- [ ] 打开系统文件选择对话框
- [ ] 可以选择图片文件（jpg, png, etc.）
- [ ] 单选和多选都正常工作
- [ ] 取消操作不会崩溃
- [ ] 选中的图片正确显示

**失败表现**:
- 文件选择器无法打开
- 无法选择图片
- 选择后应用崩溃
- 图片不显示

#### 3.2 文件选择

**测试步骤**:
1. 进入需要附件上传的页面
2. 点击文件选择按钮
3. 选择不同类型的文件

**预期结果**:
- [ ] 文件选择器正常打开
- [ ] 可以选择各种文件类型
- [ ] 文件路径正确获取

**失败表现**:
- 文件选择器无法打开
- 文件路径为空或错误

### 4. WebView 功能测试 ⚠️

**状态**: ❌ 未完成适配（Task 9 跳过）

**测试步骤**:
1. 进入企业搜索页面
2. 尝试打开 WebView

**预期结果**:
- ⚠️ 可能无法正常工作（未适配）
- ⚠️ 可能显示错误提示

**风险说明**:
- WebView 功能在桌面端不可用（flutter_inappwebview 不支持桌面）
- 需要完成 Task 9（使用 desktop_webview_window）才能正常使用
- 建议优先级: 高（如需企业搜索功能）/ 低（如不需要）

### 5. 数据同步测试

#### 5.1 本地数据库

**测试步骤**:
1. 创建一些测试数据（客户、线索、商机）
2. 关闭应用
3. 重新启动应用
4. 验证数据是否保存

**预期结果**:
- [ ] 数据正确保存到本地数据库
- [ ] 重启后数据完整恢复
- [ ] 数据库文件位置正确:
  - Windows: `%APPDATA%\CordysCRM\`
  - macOS: `~/Library/Application Support/CordysCRM/`
  - Linux: `~/.local/share/CordysCRM/`

**失败表现**:
- 数据未保存
- 重启后数据丢失
- 数据库文件路径错误

#### 5.2 网络同步

**测试步骤**:
1. 确保后端服务运行
2. 登录应用
3. 创建/修改数据
4. 触发同步
5. 验证数据同步到服务器

**预期结果**:
- [ ] 登录功能正常
- [ ] 数据可以同步到服务器
- [ ] 同步状态正确显示
- [ ] 网络错误有提示

**失败表现**:
- 无法登录
- 同步失败
- 无错误提示

### 6. 性能优化测试

#### 6.1 列表分页

**测试步骤**:
1. 进入客户/线索/商机列表
2. 观察每页显示的数据量
3. 滚动加载更多数据

**预期结果**:
- [ ] 桌面端每页显示 50 条数据
- [ ] 滚动加载流畅
- [ ] 无明显卡顿

**失败表现**:
- 分页数量不正确
- 加载缓慢
- 滚动卡顿

#### 6.2 图片缓存

**测试步骤**:
1. 浏览包含图片的页面
2. 关闭应用
3. 重新打开应用
4. 再次浏览相同页面

**预期结果**:
- [ ] 图片首次加载后缓存
- [ ] 再次访问时从缓存加载
- [ ] 加载速度明显提升

**失败表现**:
- 图片未缓存
- 每次都重新下载
- 缓存失效

### 7. 桌面端 UI 优化测试

#### 7.1 主题样式

**测试步骤**:
1. 观察桌面端的 UI 样式
2. 对比移动端样式（如果可用）

**预期结果**:
- [ ] 桌面端 padding 更大（24/16/12）
- [ ] 按钮和列表项有 hover 效果
- [ ] 整体布局适合桌面使用

**失败表现**:
- 样式与移动端相同
- 无 hover 效果
- 布局不适合桌面

#### 7.2 键盘快捷键

**测试步骤**:
1. 尝试以下快捷键:
   - Ctrl/Cmd + N: 新建
   - Ctrl/Cmd + S: 保存
   - Ctrl/Cmd + F: 搜索
   - Ctrl/Cmd + R: 刷新
   - Esc: 取消/返回

**预期结果**:
- [ ] 快捷键功能正常
- [ ] 在文本输入框中不触发快捷键

**失败表现**:
- 快捷键无响应
- 在输入框中误触发

### 8. 移动端特有功能测试

#### 8.1 语音录制

**测试步骤**:
1. 进入跟进记录页面
2. 查看语音录制组件

**预期结果**:
- [ ] 显示"此功能仅在移动端可用"提示
- [ ] 组件处于禁用状态

**失败表现**:
- 显示可用状态
- 点击后崩溃

#### 8.2 相机功能

**测试步骤**:
1. 进入图片选择页面
2. 查看相机选项

**预期结果**:
- [ ] 相机选项不显示或禁用
- [ ] 只显示"从文件选择"选项

**失败表现**:
- 相机选项可用
- 点击后崩溃

### 9. 边界情况测试

#### 9.1 文件路径测试

**测试步骤**:
1. 选择包含非 ASCII 字符的文件（如中文路径）
2. 选择超长路径的文件
3. 选择特殊字符路径的文件

**预期结果**:
- [ ] 非 ASCII 路径正确处理
- [ ] 超长路径有错误提示或正确处理
- [ ] 特殊字符路径正确转义

**失败表现**:
- 路径解析失败
- 应用崩溃
- 文件无法读取

#### 9.2 权限测试

**测试步骤**:
1. 首次打开文件选择器（观察权限请求）
2. 拒绝文件访问权限
3. 授予文件访问权限

**预期结果**:
- [ ] 权限请求提示清晰
- [ ] 拒绝权限后有友好提示
- [ ] 授予权限后功能正常

**失败表现**:
- 无权限提示
- 拒绝后崩溃
- 授予后仍无法使用

#### 9.3 网络异常测试

**测试步骤**:
1. 断开网络连接
2. 尝试登录和同步
3. 恢复网络连接
4. 触发重试

**预期结果**:
- [ ] 断网时有明确提示
- [ ] 同步失败有重试机制
- [ ] 恢复网络后自动重试
- [ ] 超时有合理提示

**失败表现**:
- 无网络错误提示
- 应用卡死
- 无重试机制

#### 9.4 登录状态测试

**测试步骤**:
1. 登录应用
2. 等待 token 过期（或手动清除）
3. 尝试操作需要认证的功能

**预期结果**:
- [ ] Token 过期后自动刷新或跳转登录
- [ ] 跨窗口登录状态同步（如果支持多窗口）
- [ ] 登出后清理敏感数据

**失败表现**:
- Token 过期后崩溃
- 无法刷新 token
- 敏感数据未清理

---

## 验证结果汇总

### 通过标准

- [ ] 所有核心功能测试通过
- [ ] 窗口管理功能正常
- [ ] 文件选择功能正常
- [ ] 数据同步功能正常
- [ ] 性能优化生效
- [ ] UI 优化正确应用
- [ ] 移动端特有功能正确处理

### 已知风险

1. **WebView 功能未适配** (Task 9 跳过)
   - 影响: 企业搜索功能可能不可用
   - 优先级: 中等
   - 建议: 完成 Task 9 或使用外部浏览器

2. **代码质量警告** (16 个)
   - 影响: 不影响功能，但建议清理
   - 优先级: 低
   - 建议: 后续优化时处理

### 待补测项

- [ ] Windows 平台完整测试
- [ ] macOS 平台完整测试
- [ ] Linux 平台完整测试
- [ ] 跨平台数据迁移测试
- [ ] 长时间运行稳定性测试

---

## 问题报告模板

如果发现问题，请使用以下模板报告:

```
### 问题描述
[简要描述问题]

### 复现步骤
1. [步骤 1]
2. [步骤 2]
3. [步骤 3]

### 预期结果
[应该发生什么]

### 实际结果
[实际发生了什么]

### 环境信息
- 操作系统: [Windows/macOS/Linux + 版本]
- Flutter 版本: [flutter --version]
- 设备信息: [CPU, 内存等]

### 日志/截图
[粘贴相关日志或截图]
```

---

## 下一步行动

### 立即执行

1. 在目标平台上运行应用
2. 执行本清单中的所有测试
3. 记录测试结果
4. 报告发现的问题

### 后续任务

1. 完成 Task 9: WebView 适配
2. 清理代码质量警告
3. 编写自动化测试 (Task 14)
4. 更新文档 (Task 15)
5. 全平台验证 (Task 16)

---

## 联系方式

如有问题或需要支持，请联系开发团队。
