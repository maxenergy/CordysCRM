<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.cordys.crm.integration.mapper.ExtEnterpriseProfileMapper">

    <!-- 显式插入语句，指定 reg_date 的 jdbcType=DATE -->
    <insert id="insertWithDateConversion" parameterType="cn.cordys.crm.integration.domain.EnterpriseProfile">
        INSERT INTO enterprise_profile (
            id, customer_id, iqicha_id, credit_code, company_name, legal_person,
            reg_capital, reg_date, staff_size, industry_code, industry_name,
            province, city, address, status, phone, email, website,
            shareholders, executives, risks, source, last_sync_at,
            organization_id, create_time, update_time, create_user, update_user
        ) VALUES (
            #{id}, #{customerId}, #{iqichaId}, #{creditCode}, #{companyName}, #{legalPerson},
            #{regCapital}, #{regDate,jdbcType=DATE}, #{staffSize}, #{industryCode}, #{industryName},
            #{province}, #{city}, #{address}, #{status}, #{phone}, #{email}, #{website},
            #{shareholders}, #{executives}, #{risks}, #{source}, #{lastSyncAt},
            #{organizationId}, #{createTime}, #{updateTime}, #{createUser}, #{updateUser}
        )
    </insert>

    <!-- 显式更新语句，指定 reg_date 的 jdbcType=DATE -->
    <update id="updateWithDateConversion" parameterType="cn.cordys.crm.integration.domain.EnterpriseProfile">
        UPDATE enterprise_profile
        SET customer_id = #{customerId},
            iqicha_id = #{iqichaId},
            credit_code = #{creditCode},
            company_name = #{companyName},
            legal_person = #{legalPerson},
            reg_capital = #{regCapital},
            reg_date = #{regDate,jdbcType=DATE},
            staff_size = #{staffSize},
            industry_code = #{industryCode},
            industry_name = #{industryName},
            province = #{province},
            city = #{city},
            address = #{address},
            status = #{status},
            phone = #{phone},
            email = #{email},
            website = #{website},
            shareholders = #{shareholders},
            executives = #{executives},
            risks = #{risks},
            source = #{source},
            last_sync_at = #{lastSyncAt},
            update_time = #{updateTime},
            update_user = #{updateUser}
        WHERE id = #{id}
    </update>

    <select id="selectByCreditCode" resultType="cn.cordys.crm.integration.domain.EnterpriseProfile">
        SELECT id, customer_id, iqicha_id, credit_code, company_name, legal_person,
               reg_capital, reg_date, staff_size, industry_code, industry_name,
               province, city, address, status, phone, email, website,
               shareholders, executives, risks, source, last_sync_at,
               organization_id, create_time, update_time, create_user, update_user
        FROM enterprise_profile
        WHERE credit_code = #{creditCode} AND organization_id = #{orgId}
    </select>

    <select id="selectByCustomerId" resultType="cn.cordys.crm.integration.domain.EnterpriseProfile">
        SELECT id, customer_id, iqicha_id, credit_code, company_name, legal_person,
               reg_capital, reg_date, staff_size, industry_code, industry_name,
               province, city, address, status, phone, email, website,
               shareholders, executives, risks, source, last_sync_at,
               organization_id, create_time, update_time, create_user, update_user
        FROM enterprise_profile
        WHERE customer_id = #{customerId}
    </select>

    <select id="searchByCompanyName" resultType="cn.cordys.crm.integration.domain.EnterpriseProfile">
        SELECT id, customer_id, iqicha_id, credit_code, company_name, legal_person,
               reg_capital, reg_date, staff_size, industry_code, industry_name,
               province, city, address, status, phone, email, website,
               shareholders, executives, risks, source, last_sync_at,
               organization_id, create_time, update_time, create_user, update_user
        FROM enterprise_profile
        WHERE company_name LIKE CONCAT('%', #{companyName}, '%')
          AND organization_id = #{orgId}
        ORDER BY create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <select id="countByCompanyName" resultType="long">
        SELECT COUNT(1)
        FROM enterprise_profile
        WHERE company_name LIKE CONCAT('%', #{companyName}, '%')
          AND organization_id = #{orgId}
    </select>

</mapper>
