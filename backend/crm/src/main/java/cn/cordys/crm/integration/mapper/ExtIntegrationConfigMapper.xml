<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.cordys.crm.integration.mapper.ExtIntegrationConfigMapper">

    <!-- 结果映射，处理下划线到驼峰的转换 -->
    <resultMap id="IntegrationConfigResultMap" type="cn.cordys.crm.integration.domain.IntegrationConfig">
        <id property="id" column="id"/>
        <result property="configKey" column="config_key"/>
        <result property="configValue" column="config_value"/>
        <result property="encrypted" column="encrypted"/>
        <result property="organizationId" column="organization_id"/>
        <result property="description" column="description"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="createUser" column="create_user"/>
        <result property="updateUser" column="update_user"/>
    </resultMap>

    <select id="selectByKey" resultMap="IntegrationConfigResultMap">
        SELECT id, config_key, config_value, encrypted, organization_id,
               description, create_time, update_time, create_user, update_user
        FROM integration_config
        WHERE config_key = #{configKey} AND organization_id = #{orgId}
    </select>

    <select id="selectByOrganization" resultMap="IntegrationConfigResultMap">
        SELECT id, config_key, config_value, encrypted, organization_id,
               description, create_time, update_time, create_user, update_user
        FROM integration_config
        WHERE organization_id = #{orgId}
        ORDER BY config_key
    </select>

    <insert id="upsert">
        INSERT INTO integration_config (id, config_key, config_value, encrypted,
                                        organization_id, description,
                                        create_time, update_time, create_user, update_user)
        VALUES (#{config.id}, #{config.configKey}, #{config.configValue}, #{config.encrypted},
                #{config.organizationId}, #{config.description},
                #{config.createTime}, #{config.updateTime}, #{config.createUser}, #{config.updateUser})
        ON DUPLICATE KEY UPDATE
            config_value = #{config.configValue},
            encrypted = #{config.encrypted},
            description = #{config.description},
            update_time = #{config.updateTime},
            update_user = #{config.updateUser}
    </insert>

</mapper>
